# 配置生成

配置生成模块用于将所有配置转换为标准的代理客户端配置文件。

## 主要功能

### 1. Mihomo 配置生成

生成 Mihomo (Clash Meta) 格式的 YAML 配置文件。

**功能特点：**
- 自动整合订阅、节点、策略组、规则
- 支持所有 Mihomo 节点协议
- 支持所有策略组类型
- 支持 rule-providers 规则集
- 配置即时生成，无需等待

**生成的配置包含：**
```yaml
# 基础配置
mixed-port: 7890
allow-lan: true
mode: rule
log-level: info

# 节点列表
proxies:
  - name: "节点1"
    type: ss
    server: xxx
    port: 443
    # ...

# 策略组
proxy-groups:
  - name: "✈️ 代理选择"
    type: select
    proxies:
      - 🇭🇰 香港节点
      - 🇸🇬 新加坡节点
      # ...

# 规则集
rule-providers:
  reject:
    type: http
    behavior: domain
    url: "xxx"
    # ...

# 规则
rules:
  - RULE-SET,reject,REJECT
  - RULE-SET,proxy,✈️ 代理选择
  - GEOIP,CN,DIRECT
  - MATCH,✈️ 代理选择
```

**操作：**
- **预览配置**：点击"预览配置"查看生成的 YAML 内容
- **下载配置**：点击"下载配置"保存为 `mihomo-config.yaml` 文件

### 2. MosDNS 配置生成

生成 MosDNS 格式的 YAML 配置文件。

**功能特点：**
- 根据规则配置自动生成 DNS 分流
- 支持国内外 DNS 分流
- 支持规则集映射
- 自动按规则顺序生成配置

**操作：**
- **预览配置**：点击"预览配置"查看生成的 YAML 内容
- **下载配置**：点击"下载配置"保存为 `mosdns-config.yaml` 文件

### 3. 配置预览

在线查看生成的配置内容。

**特点：**
- 语法高亮显示
- 代码格式化
- 支持复制到剪贴板
- 预览不会下载文件

**操作步骤：**
1. 点击"预览 Mihomo 配置"或"预览 MosDNS 配置"
2. 在弹出的对话框中查看配置
3. 可以复制部分或全部内容
4. 关闭对话框不会保存文件

### 4. 配置导出

将所有配置数据导出为 JSON 文件。

**导出内容包含：**
- 所有订阅配置
- 所有节点数据
- 所有策略组配置
- 所有规则和规则集
- 所有规则仓库数据

**JSON 格式示例：**
```json
{
  "subscriptions": [...],
  "nodes": [...],
  "proxy_groups": [...],
  "all_rules": [...],
  "rule_library": [...]
}
```

**用途：**
- 配置备份
- 迁移到其他服务器
- 版本控制
- 配置分享（去除敏感信息后）

**操作：**
1. 点击"导出配置"按钮
2. 自动下载 `config-export.json` 文件
3. 妥善保管导出文件

### 5. 配置导入

从 JSON 文件恢复配置。

**导入方式：**

**方式1：直接上传**
1. 点击"导入配置"按钮
2. 在文件选择对话框中选择 JSON 文件
3. 系统自动读取并导入
4. 导入完成后刷新页面

**方式2：拖拽上传**
1. 将 JSON 文件拖到上传区域
2. 自动开始导入
3. 导入完成后刷新页面

**注意事项：**
- 导入会**覆盖**当前所有配置
- 导入前建议先导出当前配置备份
- 导入后页面会自动刷新

### 6. 配置统计

实时显示当前配置的统计信息。

**统计项目：**
- **订阅数量**：已添加的订阅源数量
- **节点数量**：已添加的代理节点数量
- **规则数量**：单条规则的数量
- **规则集数量**：引用的规则集数量
- **策略组数量**：已配置的策略组数量

**用途：**
- 快速了解配置规模
- 检查配置是否完整
- 确认导入导出是否成功

## 使用场景

**场景1：日常使用**
```
1. 配置好订阅、节点、策略组、规则
2. 点击"预览 Mihomo 配置"检查配置
3. 点击"下载 Mihomo 配置"获取配置文件
4. 将配置文件导入 Clash Meta 客户端
5. 启动代理服务
```

**场景2：配置备份**
```
定期备份流程：
1. 点击"导出配置"
2. 保存 config-export.json 文件
3. 上传到云存储或 Git 仓库
4. 记录备份日期和版本

恢复流程：
1. 点击"导入配置"
2. 选择备份的 JSON 文件
3. 等待导入完成
4. 刷新页面验证
```

**场景3：配置迁移**
```
从服务器A迁移到服务器B：
1. 在服务器A上导出配置
2. 下载 config-export.json
3. 在服务器B上部署系统
4. 导入 config-export.json
5. 验证配置正确性
```

**场景4：多端同步**
```
在不同设备使用相同配置：
1. 在主设备上配置并导出
2. 将 JSON 文件保存到云盘
3. 在其他设备上导入相同的 JSON
4. 所有设备使用一致的配置

更新配置时：
1. 在主设备修改配置
2. 重新导出 JSON
3. 在其他设备上重新导入
```

**场景5：配置预览调试**
```
配置调试流程：
1. 修改规则或策略组
2. 点击"预览配置"查看生成的 YAML
3. 检查语法和逻辑
4. 如有问题，返回修改
5. 重复2-4直到满意
6. 下载最终配置
```

## 最佳实践

### 配置验证
- 生成配置前检查统计信息
- 使用预览功能检查配置语法
- 在测试环境验证配置

### 备份策略
- 重大修改前先导出配置
- 定期备份配置到云存储
- 保留多个版本的备份

### 配置管理
- 使用 Git 管理配置版本
- 记录每次修改的原因
- 保持配置简洁，避免冗余
