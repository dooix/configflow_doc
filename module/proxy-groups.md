# 策略管理

策略管理模块用于配置策略组，支持多种策略类型和灵活的节点来源配置。

## 策略组类型

### 1. Select（手动选择）

手动选择节点的策略组。

**特点：**
- 需要手动在客户端切换节点
- 适合需要手动控制的场景
- 可以包含节点或其他策略组

**配置示例：**
```
名称：✈️ 代理选择
类型：select
节点来源：
  - 订阅来源：香港机场
  - 正则过滤：香港|HK
```

### 2. URL-Test（自动测速）

自动选择延迟最低的节点。

**特点：**
- 定期测试所有节点延迟
- 自动选择最快的节点
- 适合追求速度的场景

**配置参数：**
- **测试 URL**：用于测速的网址（默认：https://www.gstatic.com/generate_204）
- **测试间隔**：多久测试一次（秒，默认：300）
- **容差**：延迟差值阈值（毫秒，默认：150）

**配置示例：**
```
名称：🚀 自动选择
类型：url-test
测试URL：https://www.gstatic.com/generate_204
间隔：300秒
容差：150ms
节点来源：订阅来源（全部节点）
```

### 3. Fallback（故障转移）

主节点不可用时自动切换到备用节点。

**特点：**
- 优先使用第一个节点
- 节点不可用时自动切换到下一个
- 适合追求稳定性的场景

**配置参数：**
- **测试 URL**：用于健康检查的网址
- **测试间隔**：健康检查间隔

**配置示例：**
```
名称：🛡 故障转移
类型：fallback
节点来源：
  - 手动选择：主节点、备用节点1、备用节点2
```

### 4. Load-Balance（负载均衡）

在多个节点间分配流量。

**特点：**
- 将流量分散到多个节点
- 提高带宽利用率
- 适合大流量场景

**负载策略：**
- **round-robin**：轮询，按顺序分配
- **consistent-hashing**：一致性哈希，相同目标使用相同节点
- **sticky-sessions**：会话保持，同一会话使用相同节点

**配置参数：**
- **测试 URL**：健康检查网址
- **测试间隔**：检查间隔
- **负载策略**：选择负载算法
- **懒加载（lazy）**：是否延迟加载节点

**配置示例：**
```
名称：⚖️ 负载均衡
类型：load-balance
策略：consistent-hashing
懒加载：false
节点来源：订阅来源（全部香港节点）
```

## 节点来源配置

### 1. 订阅来源

从指定的订阅筛选节点。

**配置方式：**
- 勾选"订阅"来源类型
- 选择一个或多个订阅
- 该订阅下的所有启用节点都会包含在策略组中

**示例：**
```
订阅来源：
  ☑ 香港机场
  ☑ 新加坡机场
```

### 2. 正则过滤

使用正则表达式过滤节点名称。

**配置方式：**
- 输入正则表达式
- 匹配节点名称中包含特定关键字的节点

**常用正则示例：**
```
香港|HK|Hong Kong      # 筛选香港节点
美国|US|United States  # 筛选美国节点
日本|JP|Japan          # 筛选日本节点
^(?!.*流量).*$         # 排除包含"流量"的节点
(香港|新加坡).*IPLC    # 筛选香港或新加坡的IPLC节点
```

### 3. 手动选择节点

手动勾选特定的节点。

**配置方式：**
- 勾选"节点"来源类型
- 从节点列表中勾选需要的节点
- 支持多选

**适用场景：**
- 需要精确控制策略组包含的节点
- 将特定的高质量节点组成策略组

### 4. 引用策略组

将其他策略组作为节点来源。

**配置方式：**
- 勾选"策略"来源类型
- 选择一个或多个已存在的策略组
- 被引用的策略组会出现在当前策略组的节点列表中

**适用场景：**
- 构建多层策略结构
- 例如："代理选择" → "香港节点" → 具体节点

**示例结构：**
```
策略组1：🇭🇰 香港节点
  类型：url-test
  节点：所有香港节点

策略组2：✈️ 代理选择
  类型：select
  节点来源：
    - 策略组：🇭🇰 香港节点
    - 策略组：🇸🇬 新加坡节点
    - DIRECT
```

### 5. 跟随模式

跟随另一个策略组的节点配置。

**配置方式：**
- 勾选"跟随"来源类型
- 选择要跟随的策略组
- 当前策略组会自动使用被跟随策略组的节点列表

**特点：**
- 跟随模式互斥，勾选后其他来源类型会被禁用
- 被跟随的策略组节点变化时，当前策略组会自动同步

**适用场景：**
- 创建不同类型但使用相同节点集的策略组
- 例如：自动测速组和手动选择组使用相同节点

## 策略组管理

- **添加策略组**：配置名称、类型和节点来源
- **编辑策略组**：修改策略组配置
- **删除策略组**：删除策略组
- **排序**：拖拽调整策略组顺序

## 使用场景

**场景1：构建多层代理策略**
```
1. 创建地区策略组
   - 🇭🇰 香港节点（url-test，自动选择最快的香港节点）
   - 🇸🇬 新加坡节点（url-test，自动选择最快的新加坡节点）
   - 🇯🇵 日本节点（url-test，自动选择最快的日本节点）

2. 创建总代理策略
   - ✈️ 代理选择（select，手动选择地区）
   - 节点来源：引用上面三个策略组

3. 创建最终出口
   - 🌐 节点选择（select）
   - 选项：✈️ 代理选择、DIRECT、REJECT
```

**场景2：游戏加速策略**
```
策略组：🎮 游戏加速
类型：load-balance
策略：consistent-hashing（保证同一服务器使用同一节点）
节点来源：
  - 订阅来源：游戏专线
  - 正则过滤：IPLC|专线
```

## 最佳实践

### 策略组层次结构
```
┌─ 最终策略
│  └─ 🌐 节点选择 (select)
│      ├─ ✈️ 代理选择 (select)
│      │   ├─ 🇭🇰 香港节点 (url-test)
│      │   ├─ 🇸🇬 新加坡节点 (url-test)
│      │   └─ 🇯🇵 日本节点 (url-test)
│      ├─ DIRECT
│      └─ REJECT
```

### 策略组命名
- 使用 Emoji 增强可读性
- ✈️ 表示代理
- 🇭🇰 🇸🇬 🇯🇵 表示地区
- 🎬 表示流媒体
- 🎮 表示游戏

### 节点来源配置
- 地区策略组：使用订阅+正则过滤
- 总代理策略：引用地区策略组
- 特殊用途：手动选择特定节点
